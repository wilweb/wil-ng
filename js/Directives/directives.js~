define(["angular", "jquery", "fancybox", "tiledGallery"], function() {
'use strict';

  angular.module('myApp.directives', [])

  	.directive('tiledGallery', function($http){
      return {
      	// restrict to element name: <tiled-gallery></tiled-gallery>
        restrict: 'C',
        // This HTML will replace the tiledGallery directive.
        replace: true,
        transclude: true,
        template: '',
        
        // The linking function will add behavior to the template
        link: function(scope, element, attrs) {
            var template;
            var tiledGalleryWidth = $('.main-content').width();

            // NOTES: To debug potential Photo PHP issues:
            // 1. tile-gallery-init.php is served either on local apache-php-enabled server or via Heroku PHP server at http://my-ptflo.herokuapp.com
            // 2. Photos that tiled-gallery-init.php uses will be on 
            //     a. locally: /srv/www/apache/gitrepos/wil-ng/img/photos
            //     b. remotely on heroku: http://my-ptflo.herokuapp.com/wil-ng/app/img/photos/sf-w480.jpg
            // 3. DEBUG by going to https://my-ptflo.herokuapp.com/js/lib/tiled-gallery/tiled-gallery-init.php to see if tiled gallery photo's display;
            // if not, then the remote php server is not running

            // set siteRootUrl = https://localhost/gitrepos/wil-ng, if running wil-ng locally
            // set siteRootUrl = https://my-ptflo.herokuapp.com, if running wil-ng deployed on heroku
            var siteRootUrl = window.location.href.replace('/#/photos','');
            //console.log('siteRootUrl=' + siteRootUrl);
           
            var photoTiledGalleryUrl = siteRootUrl + '/js/lib/tiled-gallery/tiled-gallery-init.php';
            //console.log('photoTiledGalleryUrl=' + photoTiledGalleryUrl);
                               
            // pass into the php the initial gallery width so that images can be sized properly
            // without having to call TiledGalleryInstance.resize();              
            $http({method: 'GET', url: photoTiledGalleryUrl,  params: {site_root_url: siteRootUrl, gallery_width: tiledGalleryWidth}}).          
            ////$http({method: 'GET', url: 'https://my-ptflo.herokuapp.com/js/lib/tiled-gallery/tiled-gallery-init.php',  params: {gallery_width: tiledGalleryWidth}}).
            ////$http({method: 'GET', url: '//p.wilyan.com/js/lib/tiled-gallery/tiled-gallery-init.php',  params: {gallery_width: tiledGalleryWidth}}).
  		      ////$http({method: 'GET', url: '//ng-wilyan.rhcloud.com/app/js/lib/tiled-gallery/tiled-gallery-init.php',  params: {gallery_width: tiledGalleryWidth}}).
  			
  		      success(function(data, status, headers, config) {
  		           //template = data;
  		           template = '<div class="tiled-gallery type-rectangular" data-original-width="357.5312"><div class="gallery-row wil" style="width: 352.5312px; height: 174px;"><div class="gallery-group images-1" style="width: 235px; height: 178px;"><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/kauai2-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/kauai2-w480.jpg" width="231" height="174" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div></div><div class="gallery-group images-2" style="width: 117px; height: 178px;"><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/sydney-aquarium-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/sydney-aquarium-w480.jpg" width="113" height="85" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/kauai-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/kauai-w480.jpg" width="113" height="85" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div></div></div><div class="gallery-row wil" style="width: 352.5312px; height: 245px;"><div class="gallery-group images-2" style="width: 164px; height: 249px;"><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/Italy-Ostia-Antica-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/Italy-Ostia-Antica-w480.jpg" width="160" height="120" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/ScienceWorld_SkyTrain-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/ScienceWorld_SkyTrain-w480.jpg" width="160" height="121" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div></div><div class="gallery-group images-1" style="width: 188px; height: 249px;"><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/Belgium-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/Belgium-w480.jpg" width="184" height="245" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div></div></div><div class="gallery-row wil" style="width: 352.5312px; height: 85px;"><div class="gallery-group images-1" style="width: 117px; height: 89px;"><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/Australia-Sydney-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/Australia-Sydney-w480.jpg" width="113" height="85" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div></div><div class="gallery-group images-1" style="width: 117px; height: 89px;"><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/golden-gate-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/golden-gate-w480.jpg" width="113" height="85" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div></div><div class="gallery-group images-1" style="width: 118px; height: 89px;"><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/leaves-detroit-w480"><img src="https://my-ptflo.herokuapp.com/img/photos/leaves-detroit-w480" width="114" height="85" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div></div></div><div class="gallery-row wil" style="width: 352.5312px; height: 129px;"><div class="gallery-group images-1" style="width: 176px; height: 133px;"><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/YVR-West-End-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/YVR-West-End-w480.jpg" width="172" height="129" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div></div><div class="gallery-group images-1" style="width: 176px; height: 133px;"><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/Parc-Guel-1-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/Parc-Guel-1-w480.jpg" width="172" height="129" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div></div></div><div class="gallery-row wil" style="width: 352.5312px; height: 174px;"><div class="gallery-group images-1" style="width: 235px; height: 178px;"><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/Detroit-ibm-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/Detroit-ibm-w480.jpg" width="231" height="174" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div></div><div class="gallery-group images-2" style="width: 117px; height: 178px;"><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/Palm-Beach-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/Palm-Beach-w480.jpg" width="113" height="85" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/Gondolas-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/Gondolas-w480.jpg" width="113" height="85" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div></div></div><div class="gallery-row wil" style="width: 352.5312px; height: 85px;"><div class="gallery-group images-1" style="width: 117px; height: 89px;"><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/fall-detroit-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/fall-detroit-w480.jpg" width="113" height="85" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div></div><div class="gallery-group images-1" style="width: 117px; height: 89px;"><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/Rome-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/Rome-w480.jpg" width="113" height="85" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div></div><div class="gallery-group images-1" style="width: 118px; height: 89px;"><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/sf-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/sf-w480.jpg" width="114" height="85" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div></div></div><div class="gallery-row wil" style="width: 352.5312px; height: 174px;"><div class="gallery-group images-2" style="width: 117px; height: 178px;"><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/tree-ibm2-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/tree-ibm2-w480.jpg" width="113" height="85" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/Disney-Animal-Kingdom-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/Disney-Animal-Kingdom-w480.jpg" width="113" height="85" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div></div><div class="gallery-group images-1" style="width: 235px; height: 178px;"><div class="tiled-gallery-item small"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/Roman-Forum-2-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/Roman-Forum-2-w480.jpg" width="231" height="174" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div></div></div><div class="gallery-row wil" style="width: 352.5312px; height: 261px;"><div class="gallery-group images-1" style="width: 352px; height: 265px;"><div class="tiled-gallery-item large"><a class="fancybox" rel="group" href="https://my-ptflo.herokuapp.com/img/photos/Illuminations-3-w480.jpg"><img src="https://my-ptflo.herokuapp.com/img/photos/Illuminations-3-w480.jpg" width="348" height="261" align="left"></a><div class="tiled-gallery-caption" style="display: none;"><i class="icon-zoom-in"></i></div></div></div></div></div>';
  		           element.append(template);

  		           // after loading the tiled gallery HTML generated by tiled-gallery-init.php,
  		           // intiallize the tiled gallery in tiled-gallery.js
  		           var TiledGalleryInstance = new TiledGallery;
  		           $(".fancybox").fancybox();

  		      }).
  		      error(function(data, status, headers, config) {
  		           // called asynchronously if an error occurs
  			       // or server returns response with an error status.
  		      });

        }
      }
  	}
  );
});
